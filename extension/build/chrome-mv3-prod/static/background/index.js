var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,a,r,n,o){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s="function"==typeof i[n]&&i[n],l=s.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function E(e,a){if(!l[e]){if(!t[e]){var r="function"==typeof i[n]&&i[n];if(!a&&r)return r(e,!0);if(s)return s(e,!0);if(c&&"string"==typeof e)return c(e);var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}d.resolve=function(a){var r=t[e][1][a];return null!=r?r:a},d.cache={};var u=l[e]=new E.Module(e);t[e][0].call(u.exports,d,u,u.exports,this)}return l[e].exports;function d(e){var t=d.resolve(e);return!1===t?{}:E(t)}}E.isParcelRequire=!0,E.Module=function(e){this.id=e,this.bundle=E,this.exports={}},E.modules=t,E.cache=l,E.parent=s,E.register=function(e,a){t[e]=[function(e,t){t.exports=a},{}]},Object.defineProperty(E,"root",{get:function(){return i[n]}}),i[n]=E;for(var u=0;u<a.length;u++)E(a[u]);if(r){var d=E(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof e&&e.amd?e(function(){return d}):o&&(this[o]=d)}}({acq2k:[function(e,t,a){e("../../../src/background/index")},{"../../../src/background/index":"2YijW"}],"2YijW":[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js"),n=e("webextension-polyfill"),o=r.interopDefault(n),i=e("../constants"),s=e("../config/storageKeys"),l=e("../types/messages"),c=e("../utils");let E="[Imagion Background]",u=new Map,d=new Map,p=[],f=[],T=0,_=null,g=0,m=null,A=[],S=M();async function I(){if(_)return _;let e=await (0,o.default).storage.local.get({[s.STORAGE_KEYS.API_KEY]:"",[s.STORAGE_KEYS.DETECTION_ENDPOINT]:i.DEFAULT_DETECTION_ENDPOINT,[s.STORAGE_KEYS.DETECTION_MODE]:"api",[s.STORAGE_KEYS.LOCAL_ENDPOINT]:i.LOCAL_DETECTION_ENDPOINT_DEFAULT,[s.STORAGE_KEYS.PLAN_TIER]:"free"}),t={imagionApiKey:"string"==typeof e[s.STORAGE_KEYS.API_KEY]?e[(0,s.STORAGE_KEYS).API_KEY].trim():"",imagionDetectionEndpoint:"string"==typeof e[s.STORAGE_KEYS.DETECTION_ENDPOINT]&&e[(0,s.STORAGE_KEYS).DETECTION_ENDPOINT].trim().length>0?e[(0,s.STORAGE_KEYS).DETECTION_ENDPOINT].trim():i.DEFAULT_DETECTION_ENDPOINT,detectionMode:"local"===e[s.STORAGE_KEYS.DETECTION_MODE]?"local":"api",localDetectionEndpoint:"string"==typeof e[s.STORAGE_KEYS.LOCAL_ENDPOINT]&&e[(0,s.STORAGE_KEYS).LOCAL_ENDPOINT].trim().length>0?e[(0,s.STORAGE_KEYS).LOCAL_ENDPOINT].trim():i.LOCAL_DETECTION_ENDPOINT_DEFAULT,planTier:"pro"===e[s.STORAGE_KEYS.PLAN_TIER]?"pro":"free"};return _=t,t}async function y(e){let t=(0,c.normalizeImageUrl)(e.imageUrl,e.pageUrl);if(!t)return console.warn(E,"Invalid URL:",e.imageUrl),{status:"error",message:"Unable to resolve image URL.",badgeId:e.badgeId,imageUrl:e.imageUrl};let a=await I(),r=(0,c.buildRequestKey)(t,a.detectionMode),n=function(e){let t=u.get(e);return t?Date.now()-t.timestamp>i.REQUEST_TTL_MS?(u.delete(e),null):(u.delete(e),u.set(e,t),t.payload):null}(r);return n?{...n,badgeId:e.badgeId,imageUrl:t}:new Promise(n=>{let o={badgeId:e.badgeId,resolve:n},i=d.get(r);if(i){i.resolvers.push(o);return}d.set(r,{resolvers:[o]}),p.push({imageUrl:t,requestKey:r,mode:a.detectionMode,imagionApiKey:a.imagionApiKey,imagionDetectionEndpoint:a.imagionDetectionEndpoint,localEndpoint:a.localDetectionEndpoint}),h()})}function h(){if(!(Date.now()<g))for(;T<i.MAX_CONCURRENT_DETECTIONS&&p.length>0;){let e=p.shift();e&&(T+=1,O(e).catch(()=>{}).finally(()=>{T-=1,h()}))}}async function O(e){let t,a,r;let{imageUrl:n,requestKey:s,mode:l,imagionApiKey:u,imagionDetectionEndpoint:d,localEndpoint:p}=e;if("api"===l&&!u){console.warn(E,"No API key configured for API mode"),G({level:"warning",message:"missing_api_key",details:{imageUrl:n,mode:l}}),D(n,s,{status:"missing-key",message:"Please provide an Imagion API key in the options page."});return}try{t=await R(n)}catch(t){let e=t instanceof Error?t.message:String(t);console.error(E,"Failed to fetch image:",{imageUrl:n,mode:l,error:e,errorType:t instanceof Error?t.name:typeof t,stack:t instanceof Error?t.stack:void 0}),G({level:"error",message:"fetch_image_failed",details:{imageUrl:n,error:e,mode:l}}),D(n,s,{status:"error",message:`Failed to fetch image: ${e}`});return}if(t.size>i.MAX_IMAGE_UPLOAD_BYTES){let e=(t.size/1048576).toFixed(1);console.warn(E,"Image too large:",t.size,"bytes"),G({level:"warning",message:"image_too_large",details:{imageUrl:n,size:t.size,mode:l}}),D(n,s,{status:"error",message:`Image too large (${e} MB). Maximum allowed size is 10 MB.`});return}let f=null;try{f=await (0,c.hashBlobSHA256)(t)}catch(e){console.warn(E,"Failed to hash image:",e)}if(f){let e=await w(f,l);if(e){G({level:"info",message:"local_history_hit",details:{imageUrl:n,hash:f,mode:l}});let t={...e.payload,status:e.payload.status||"success"};N(s,t),D(n,s,t,f);return}}if("api"===l&&f&&u){let e=(0,c.getCacheLookupEndpoint)(d),t=await Y(f,e,u);if(t){G({level:"info",message:"remote_cache_hit",details:{imageUrl:n,hash:f,mode:l}});let e={...t,status:t.status||"success"};N(s,e),C(f,e,l),D(n,s,e,f);return}}let T=new FormData,_=(0,c.extractFileName)(n),A=new File([t],_,{type:t.type||"image/jpeg"});T.append("file",A);let S="local"===l&&p||d,I="local"===l,y={"x-detection-source":I?"extension-local":"extension"};I||(y["x-api-key"]=u);try{a=await fetch(S,{method:"POST",headers:y,body:T})}catch(t){let e=t instanceof Error?t.message:String(t);console.error(E,"Detection request failed:",{imageUrl:n,endpoint:S,mode:l,error:e,errorType:t instanceof Error?t.name:typeof t,stack:t instanceof Error?t.stack:void 0}),G({level:"error",message:"detection_request_failed",details:{imageUrl:n,error:e,mode:l}}),D(n,s,{status:"error",message:`${I?"Local":"API"} detection failed: ${e}`},f??void 0);return}try{r=await a.json()}catch(t){let e=t instanceof Error?t.message:String(t);console.error(E,"Failed to parse detection response JSON:",{imageUrl:n,status:a.status,statusText:a.statusText,contentType:a.headers.get("content-type"),error:e,mode:l}),G({level:"error",message:"invalid_json",details:{imageUrl:n,status:a.status,error:e,mode:l}}),D(n,s,{status:"error",message:`Failed to parse response (status ${a.status}): ${e}`},f??void 0);return}if(429===a.status){let e=r,t=(0,c.parseRetryAfter)(a.headers.get("Retry-After"),i.BACKOFF_MIN_MS),o=e.retryAfter??t,u="PLAN_LIMIT_EXCEEDED"===e.errorType?"plan":"DAILY_RATE_LIMIT_EXCEEDED"===e.errorType?"daily":"burst";(function(e,t="burst"){let a=Math.min(Math.max(1e3*e,i.BACKOFF_MIN_MS),i.BACKOFF_MAX_MS);g=Date.now()+a,m&&clearTimeout(m),"plan"===t&&b({reason:t,expiresAt:g}),m=setTimeout(()=>{g=0,m=null,"plan"===t&&b(null),h()},a)})(o,u),console.warn(E,"Rate limited, retry after:",o,"seconds","mode:",l),G({level:"warning",message:"rate_limited",details:{imageUrl:n,retryAfter:o,badgeLabel:e.badgeLabel,errorType:e.errorType,mode:l}}),D(n,s,{status:"rate-limit",message:e.message??`Rate limit exceeded. Retrying in ${o} seconds.`,retryAfterSeconds:o,badgeLabel:e.badgeLabel,errorType:e.errorType},f??void 0);return}if(!a.ok){let e=r,t=e.message||e.error||"Detection failed";console.error(E,"Detection error response:",{status:a.status,statusText:a.statusText,message:t,imageUrl:n,mode:l,fullResponse:e}),G({level:"error",message:"detection_error",details:{imageUrl:n,responseStatus:a.status,message:t,fullResponse:e,mode:l}}),D(n,s,{status:"error",message:t},f??void 0);return}let O=r;if(!O.verdict){let e=O.message||O.error||"Detection returned no verdict.";console.error(E,"Detection response lacked verdict:",{imageUrl:n,responseStatus:a.status,payload:O,rawPayload:r,mode:l}),G({level:"error",message:"no_verdict_returned",details:{imageUrl:n,responseStatus:a.status,rawPayload:r,mode:l}}),D(n,s,{status:"error",message:e},f??void 0);return}let M={status:"success",verdict:O.verdict,score:O.score,confidence:O.confidence,presentation:O.presentation};G({level:"info",message:"detection_success",details:{imageUrl:n,score:O.score,verdict:O.verdict,mode:l}}),N(s,M),f&&C(f,M,l),D(n,s,M,f??void 0),O.verdict&&(0,i.AI_VERDICTS).has(O.verdict.toLowerCase())&&"number"==typeof O.score&&O.score>=i.HIGH_CONFIDENCE_AI_THRESHOLD&&function(e,t,a){let r=(100*a).toFixed(0),n=e.length>60?`${e.substring(0,57)}...`:e;(0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"AI Image Detected",message:`Verdict: ${t} (${r}% confidence)
${n}`})}(n,O.verdict,O.score)}async function R(e){let t=await fetch(e,{method:"GET",credentials:"omit"});if(!t.ok)throw Error(`Unable to fetch image (${t.status})`);let a=await t.blob();if(!a||0===a.size)throw Error("Image payload was empty.");return a}function D(e,t,a,r){let n=d.get(t);n&&(n.resolvers.forEach(({badgeId:t,resolve:n})=>{n({...a,badgeId:t,imageUrl:e,hash:r})}),d.delete(t))}function N(e,t){u.has(e)&&u.delete(e),u.set(e,{timestamp:Date.now(),payload:t}),function(){if(u.size<=i.MAX_CACHE_SIZE)return;let e=u.size-i.MAX_CACHE_SIZE,t=u.keys();for(let a=0;a<e;a++){let e=t.next();if(e.done)break;u.delete(e.value)}}()}async function M(){let e=await (0,o.default).storage.local.get(s.STORAGE_KEYS.HASH_HISTORY),t=e[s.STORAGE_KEYS.HASH_HISTORY];Array.isArray(t)?(A=t.filter(c.isHashHistoryEntry)).length>i.MAX_HASH_HISTORY&&(A=A.slice(0,i.MAX_HASH_HISTORY)):A=[]}async function L(){await S}async function w(e,t){return await L(),A.find(a=>a.hash===e&&a.mode===t)}async function C(e,t,a){await L(),(A=A.filter(t=>t.hash!==e||t.mode!==a)).unshift({hash:e,payload:t,mode:a,createdAt:Date.now()}),A.length>i.MAX_HASH_HISTORY&&(A.length=i.MAX_HASH_HISTORY),(0,o.default).storage.local.set({[s.STORAGE_KEYS.HASH_HISTORY]:A})}function x(e){e?((0,o.default).action.setBadgeText({text:i.RATE_LIMIT_BADGE_TEXT}),(0,o.default).action.setBadgeBackgroundColor({color:i.RATE_LIMIT_BADGE_COLOR})):((0,o.default).action.setBadgeText({text:""}),(0,o.default).action.setBadgeBackgroundColor({color:"#000000"}))}async function U(e){e?await (0,o.default).storage.local.set({[s.STORAGE_KEYS.RATE_LIMIT_STATE]:e}):await (0,o.default).storage.local.remove(s.STORAGE_KEYS.RATE_LIMIT_STATE)}function b(e){x(!!e),U(e)}async function P(){let e=await (0,o.default).storage.local.get(s.STORAGE_KEYS.RATE_LIMIT_STATE),t=e[s.STORAGE_KEYS.RATE_LIMIT_STATE];if((0,c.isRateLimitIndicator)(t)&&t.expiresAt>Date.now()){x(!0),g=t.expiresAt;let e=t.expiresAt-Date.now();e>0?m=setTimeout(()=>{g=0,m=null,b(null),h()},e):b(null)}else await (0,o.default).storage.local.remove(s.STORAGE_KEYS.RATE_LIMIT_STATE)}async function Y(e,t,a){try{let r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":a},body:JSON.stringify({hash:e})});if(!r.ok)return null;let n=await r.json();if(n?.found&&n.payload)return n.payload}catch(e){console.warn(E,"Backend cache lookup failed:",e)}return null}async function v(){let{imagionApiKey:e,imagionDetectionEndpoint:t}=await I();if(!e)throw Error("Missing Imagion API key");let a=(0,c.getUsageStatusEndpoint)(t),r=await fetch(a,{method:"GET",headers:{"x-api-key":e}});if(!r.ok){let e=await r.text();throw Error(`Usage status request failed (${r.status}): ${e}`)}let n=await r.json();if(!n?.success||!n?.usage)throw Error("Invalid usage status response");return n.usage}function G(e){f.push({timestamp:Date.now(),...e}),f.length>i.TELEMETRY_LIMIT&&f.shift(),(0,o.default).storage.local.set({[s.STORAGE_KEYS.TELEMETRY]:f})}async function K(e,t){let a=t?.url??"",r=(0,c.normalizeImageUrl)(e,a);if(!r){console.warn(E,"Context menu: invalid image URL:",e),await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Imagion",message:"Unable to resolve image URL."});return}try{let e;let t=await I(),a=t.detectionMode;try{e=await R(r)}catch(t){let e=t instanceof Error?t.message:String(t);await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Imagion",message:`Failed to fetch image: ${e}`});return}if(e.size>i.MAX_IMAGE_UPLOAD_BYTES){await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Imagion",message:"Image too large. Maximum allowed size is 10 MB."});return}if("api"===a&&!t.imagionApiKey){await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Imagion",message:"Please provide an Imagion API key in the options page."});return}let n=null;try{n=await (0,c.hashBlobSHA256)(e)}catch{}let s=new FormData,l=(0,c.extractFileName)(r),E=new File([e],l,{type:e.type||"image/jpeg"});s.append("file",E);let u="local"===a&&t.localDetectionEndpoint||t.imagionDetectionEndpoint,d="local"===a,p={"x-detection-source":d?"extension-local":"extension"};d||(p["x-api-key"]=t.imagionApiKey);let f=await fetch(u,{method:"POST",headers:p,body:s});if(!f.ok){let e=await f.json().catch(()=>null),t=e?.message||`Detection failed (${f.status})`;await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Imagion",message:t});return}let T=await f.json(),_=T.verdict??"Unknown",g="number"==typeof T.score?T.score:null,m=null!==g?` (score: ${(100*g).toFixed(0)}%)`:"";if(await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:`Imagion: ${_}`,message:`Verdict: ${_}${m}`}),T.verdict){let e={status:"success",verdict:T.verdict,score:T.score,confidence:T.confidence,presentation:T.presentation},t=(0,c.buildRequestKey)(r,a);N(t,e),n&&C(n,e,a)}}catch(t){let e=t instanceof Error?t.message:String(t);console.error(E,"Context menu detection failed:",e),await (0,o.default).notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Imagion",message:`Detection failed: ${e}`})}}P(),(0,o.default).storage.onChanged.addListener((e,t)=>{if("local"!==t)return;let a=e[s.STORAGE_KEYS.API_KEY]||e[s.STORAGE_KEYS.DETECTION_ENDPOINT]||e[s.STORAGE_KEYS.DETECTION_MODE]||e[s.STORAGE_KEYS.LOCAL_ENDPOINT]||e[s.STORAGE_KEYS.PLAN_TIER];a&&(_=null,u.clear(),e[s.STORAGE_KEYS.API_KEY]&&!e[s.STORAGE_KEYS.API_KEY].newValue&&b(null))}),(0,o.default).runtime.onInstalled.addListener(()=>{(0,o.default).contextMenus.create({id:i.CONTEXT_MENU_ID,title:"Analyze with Imagion",contexts:["image"]}).catch(()=>void 0),(0,o.default).alarms.create(i.ALARM_CACHE_SWEEP,{periodInMinutes:5}),(0,o.default).alarms.create(i.ALARM_KEEPALIVE,{periodInMinutes:.4})}),(0,o.default).alarms.onAlarm.addListener(e=>{e.name===i.ALARM_CACHE_SWEEP&&function(){let e=Date.now();for(let[t,a]of u)e-a.timestamp>i.REQUEST_TTL_MS&&u.delete(t)}()}),(0,o.default).contextMenus.onClicked.addListener((e,t)=>{e.menuItemId===i.CONTEXT_MENU_ID&&e.srcUrl&&K(e.srcUrl,t)}),(0,o.default).commands.onCommand.addListener(async e=>{if("toggle-badges"===e){let e=await (0,o.default).storage.local.get({[s.STORAGE_KEYS.BADGE_ENABLED]:!0}),t=e[s.STORAGE_KEYS.BADGE_ENABLED];await (0,o.default).storage.local.set({[s.STORAGE_KEYS.BADGE_ENABLED]:!t});return}if("scan-page"===e){let[e]=await (0,o.default).tabs.query({active:!0,currentWindow:!0});if(e?.id)try{await (0,o.default).tabs.sendMessage(e.id,{type:"RESCAN_PAGE"})}catch(e){console.warn(E,"Failed to send scan-page command to tab:",e)}}}),(0,o.default).runtime.onStartup.addListener(async()=>{await P(),await S;let e=await (0,o.default).alarms.get(i.ALARM_CACHE_SWEEP);e||(0,o.default).alarms.create(i.ALARM_CACHE_SWEEP,{periodInMinutes:5});let t=await (0,o.default).alarms.get(i.ALARM_KEEPALIVE);t||(0,o.default).alarms.create(i.ALARM_KEEPALIVE,{periodInMinutes:.4})}),(0,o.default).runtime.onMessage.addListener(async e=>{if(e&&"string"==typeof e.type){if(e.type===l.MESSAGE_TYPES.REQUEST_DETECTION)return y(e);if(e.type===l.MESSAGE_TYPES.REQUEST_USAGE_STATUS)try{let e=await v();return{success:!0,usage:e}}catch(e){return console.error(E,"Usage status failed:",e),{success:!1,error:e instanceof Error?e.message:"Failed to load usage status"}}if(e.type===l.MESSAGE_TYPES.REQUEST_PAGE_SUMMARY){let e=await (0,o.default).tabs.query({active:!0,currentWindow:!0}),t=e[0];if(!t?.id)return{success:!1,error:"No active tab found"};try{let e=await (0,o.default).tabs.sendMessage(t.id,{type:l.MESSAGE_TYPES.REQUEST_PAGE_SUMMARY});if(!e?.summary)return{success:!1,error:"Not available on this page"};return{success:!0,...e}}catch(e){return console.warn(E,"Page summary error:",e),{success:!1,error:"Failed to query content script"}}}}})},{"webextension-polyfill":"webextension-polyfill","../constants":"l7qfE","../config/storageKeys":"g3sEe","../types/messages":"h8t4j","../utils":"hWBpc","@parcel/transformer-js/src/esmodule-helpers.js":"fNtpZ"}],l7qfE:[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(a),r.export(a,"DEFAULT_DETECTION_ENDPOINT",()=>n),r.export(a,"LOCAL_DETECTION_ENDPOINT_DEFAULT",()=>o),r.export(a,"DEFAULT_BASE_URL",()=>i),r.export(a,"REQUEST_TTL_MS",()=>s),r.export(a,"MAX_CONCURRENT_DETECTIONS",()=>l),r.export(a,"TELEMETRY_LIMIT",()=>c),r.export(a,"BACKOFF_MIN_MS",()=>E),r.export(a,"BACKOFF_MAX_MS",()=>u),r.export(a,"MAX_HASH_HISTORY",()=>d),r.export(a,"MAX_CACHE_SIZE",()=>p),r.export(a,"MAX_IMAGE_UPLOAD_BYTES",()=>f),r.export(a,"MIN_IMAGE_DIMENSION",()=>T),r.export(a,"MAX_TRACKED_IMAGES",()=>_),r.export(a,"SCAN_DEBOUNCE_MS",()=>g),r.export(a,"INITIAL_SCAN_DELAY_MS",()=>m),r.export(a,"RATE_LIMIT_BADGE_TEXT",()=>A),r.export(a,"RATE_LIMIT_BADGE_COLOR",()=>S),r.export(a,"EXCLUDED_DOMAINS",()=>I),r.export(a,"AI_VERDICTS",()=>y),r.export(a,"UNCERTAIN_VERDICTS",()=>h),r.export(a,"REAL_VERDICTS",()=>O),r.export(a,"HIGH_CONFIDENCE_AI_THRESHOLD",()=>R),r.export(a,"CONTEXT_MENU_ID",()=>D),r.export(a,"ALARM_CACHE_SWEEP",()=>N),r.export(a,"ALARM_KEEPALIVE",()=>M),r.export(a,"AUTH_ENDPOINT_PATH",()=>L);let n="http://localhost:3000/api/detect",o="http://localhost:4000/api/detect",i="http://localhost:3000",s=3e5,l=3,c=40,E=15e3,u=6e4,d=250,p=500,f=10485760,T=50,_=200,g=300,m=500,A="!",S="#ff4d67",I=["localhost","127.0.0.1","imagion.ai","www.imagion.ai"],y=new Set(["ai","fake","ai_generated","likely_ai"]),h=new Set(["uncertain"]),O=new Set(["real","likely_real"]),R=.85,D="imagion-analyze-image",N="imagion-cache-sweep",M="imagion-keepalive",L="/api/auth/extension"},{"@parcel/transformer-js/src/esmodule-helpers.js":"fNtpZ"}],fNtpZ:[function(e,t,a){a.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},a.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.exportAll=function(e,t){return Object.keys(e).forEach(function(a){"default"===a||"__esModule"===a||t.hasOwnProperty(a)||Object.defineProperty(t,a,{enumerable:!0,get:function(){return e[a]}})}),t},a.export=function(e,t,a){Object.defineProperty(e,t,{enumerable:!0,get:a})}},{}],g3sEe:[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(a),r.export(a,"STORAGE_KEYS",()=>n);let n={API_KEY:"imagionApiKey",DETECTION_ENDPOINT:"imagionDetectionEndpoint",BADGE_ENABLED:"imagionBadgeEnabled",USER_EMAIL:"imagionUserEmail",USER_TIER:"imagionUserTier",MONTHLY_DETECTIONS:"imagionMonthlyDetections",TOTAL_DETECTIONS:"imagionTotalDetections",DAILY_DETECTIONS:"imagionDailyDetections",MONTHLY_LIMIT:"imagionMonthlyLimit",DAILY_LIMIT:"imagionDailyLimit",DETECTION_MODE:"imagionDetectionMode",LOCAL_ENDPOINT:"imagionLocalEndpoint",PLAN_TIER:"imagionPlanTier",DISABLED_HOSTS:"imagionDisabledHosts",TELEMETRY:"imagionTelemetry",HASH_HISTORY:"recentImageHistory",RATE_LIMIT_STATE:"imagionRateLimitState",ONBOARDING_COMPLETE:"imagionOnboardingComplete"}},{"@parcel/transformer-js/src/esmodule-helpers.js":"fNtpZ"}],h8t4j:[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(a),r.export(a,"MESSAGE_TYPES",()=>n);let n={REQUEST_DETECTION:"REQUEST_DETECTION",REQUEST_USAGE_STATUS:"REQUEST_USAGE_STATUS",REQUEST_PAGE_SUMMARY:"REQUEST_PAGE_SUMMARY",PAGE_SUMMARY_RESPONSE:"PAGE_SUMMARY_RESPONSE",CONTEXT_MENU_DETECT:"CONTEXT_MENU_DETECT",CONTEXT_MENU_RESULT:"CONTEXT_MENU_RESULT"}},{"@parcel/transformer-js/src/esmodule-helpers.js":"fNtpZ"}],hWBpc:[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e,t){if(!e)return null;try{return new URL(e,t||void 0).toString()}catch{return null}}function o(e){try{let t=new URL(e),a=t.pathname.split("/").filter(Boolean),r=a[a.length-1];return r||"imagion-image.jpg"}catch{return"imagion-image.jpg"}}function i(e){let t=e.trim();if(!t)return null;try{let e=new URL(t.includes("://")?t:`https://${t}`);return e.hostname.toLowerCase()}catch{return t.toLowerCase()}}function s(e,t){let a=i(e);if(!a)return!1;let r=a.startsWith("www.")?a.slice(4):a;return t.has(a)||t.has(r)}function l(e){try{let t=new URL(e);return t.pathname.endsWith("/api/detect")?t.pathname=t.pathname.replace(/\/api\/detect$/,"/api/cache/hash"):t.pathname=`${t.pathname.replace(/\/$/,"")}/api/cache/hash`,t.toString()}catch{let t=e.replace(/\/$/,"");return`${t}/api/cache/hash`}}function c(e){try{let t=new URL(e);return t.pathname.endsWith("/api/detect")?t.pathname=t.pathname.replace("/api/detect","/api/usage/status"):t.pathname=`${t.pathname.replace(/\/$/,"")}/api/usage/status`,t.toString()}catch{let t=e.replace(/\/$/,"");return`${t}/api/usage/status`}}function E(e,t){if(!e)return t/1e3;let a=Number.parseInt(e,10);return Number.isFinite(a)&&a>0?a:t/1e3}function u(e,t){return`${t}:${e}`}function d(e){return"object"==typeof e&&null!==e&&"string"==typeof e.hash&&e.hash.length>0&&"number"==typeof e.createdAt&&"object"==typeof e.payload&&null!==e.payload&&"string"==typeof e.payload.status&&("api"===e.mode||"local"===e.mode)}function p(e){return!!e&&"object"==typeof e&&["burst","daily","plan"].includes(e.reason)&&"number"==typeof e.expiresAt&&Number.isFinite(e.expiresAt)}async function f(e){let t=await e.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(a));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}function T(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function _(e){return!e||e.length<20?e:`${e.substring(0,12)}...${e.substring(e.length-4)}`}function g(e){return null==e?"\u221e":e.toLocaleString()}r.defineInteropFlag(a),r.export(a,"normalizeImageUrl",()=>n),r.export(a,"extractFileName",()=>o),r.export(a,"normalizeHostname",()=>i),r.export(a,"isHostBlocked",()=>s),r.export(a,"getCacheLookupEndpoint",()=>l),r.export(a,"getUsageStatusEndpoint",()=>c),r.export(a,"parseRetryAfter",()=>E),r.export(a,"buildRequestKey",()=>u),r.export(a,"isHashHistoryEntry",()=>d),r.export(a,"isRateLimitIndicator",()=>p),r.export(a,"hashBlobSHA256",()=>f),r.export(a,"escapeHtml",()=>T),r.export(a,"maskApiKey",()=>_),r.export(a,"formatLimit",()=>g)},{"@parcel/transformer-js/src/esmodule-helpers.js":"fNtpZ"}]},["acq2k"],"acq2k","parcelRequire36d2"),globalThis.define=t;