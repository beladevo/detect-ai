{"version":3,"file":"options.js","sources":["../src/options.ts"],"sourcesContent":["type ExtensionSettings = {\r\n  imagionApiKey: string;\r\n  imagionDetectionEndpoint: string;\r\n  imagionBadgeEnabled: boolean;\r\n  imagionDisabledHosts: string[];\r\n};\r\n\r\ntype OptionsLocaleStrings = {\r\n  savedMessage: string;\r\n  savingMessage: string;\r\n  addDomainLabel: string;\r\n  addButtonLabel: string;\r\n  removeButtonLabel: string;\r\n  domainExistsMessage: string;\r\n  domainAddedMessage: string;\r\n  domainRemovedMessage: string;\r\n  saveErrorMessage: string;\r\n  domainPlaceholder: string;\r\n};\r\n\r\nconst LOCALE_MAP: Record<string, OptionsLocaleStrings> = {\r\n  en: {\r\n    savedMessage: \"Settings saved.\",\r\n    savingMessage: \"Saving...\",\r\n    addDomainLabel: \"Disable badges on specific hosts\",\r\n    addButtonLabel: \"Add\",\r\n    removeButtonLabel: \"Remove\",\r\n    domainExistsMessage: \"Host already blocked.\",\r\n    domainAddedMessage: \"Host added.\",\r\n    domainRemovedMessage: \"Host removed.\",\r\n    saveErrorMessage: \"Unable to save settings.\",\r\n    domainPlaceholder: \"example.com\",\r\n  },\r\n  es: {\r\n    savedMessage: \"Configuración guardada.\",\r\n    savingMessage: \"Guardando...\",\r\n    addDomainLabel: \"Deshabilitar insignias en hosts específicos\",\r\n    addButtonLabel: \"Agregar\",\r\n    removeButtonLabel: \"Eliminar\",\r\n    domainExistsMessage: \"El host ya está bloqueado.\",\r\n    domainAddedMessage: \"Host agregado.\",\r\n    domainRemovedMessage: \"Host eliminado.\",\r\n    saveErrorMessage: \"No se pudieron guardar los ajustes.\",\r\n    domainPlaceholder: \"ejemplo.com\",\r\n  },\r\n};\r\n\r\nconst DEFAULTS: ExtensionSettings = {\r\n  imagionApiKey: \"\",\r\n  imagionDetectionEndpoint: \"http://localhost:3000/api/detect\",\r\n  imagionBadgeEnabled: true,\r\n  imagionDisabledHosts: [],\r\n};\r\n\r\nconst form = document.getElementById(\"settings-form\") as HTMLFormElement;\r\nconst apiKeyInput = document.getElementById(\"api-key\") as HTMLInputElement;\r\nconst endpointInput = document.getElementById(\"detection-endpoint\") as HTMLInputElement;\r\nconst badgeToggle = document.getElementById(\"badge-enabled\") as HTMLInputElement;\r\nconst statusNode = document.getElementById(\"status\") as HTMLElement;\r\nconst saveButton = document.getElementById(\"save-button\") as HTMLButtonElement;\r\nconst domainInput = document.getElementById(\"domain-input\") as HTMLInputElement;\r\nconst addDomainButton = document.getElementById(\"add-domain-btn\") as HTMLButtonElement;\r\nconst domainList = document.getElementById(\"domain-list\") as HTMLUListElement;\r\n\r\nconst localeCode = navigator.language.split(\"-\")[0];\r\nconst strings = LOCALE_MAP[localeCode] ?? LOCALE_MAP.en;\r\n\r\nlet blockedHosts: string[] = [];\r\n\r\nfunction getStorage(): Promise<ExtensionSettings> {\r\n  return new Promise((resolve) => {\r\n    chrome.storage.local.get(DEFAULTS, (items) => {\r\n      resolve({\r\n        imagionApiKey: typeof items.imagionApiKey === \"string\" ? items.imagionApiKey : \"\",\r\n        imagionDetectionEndpoint:\r\n          typeof items.imagionDetectionEndpoint === \"string\" && items.imagionDetectionEndpoint.trim().length > 0\r\n            ? items.imagionDetectionEndpoint.trim()\r\n            : DEFAULTS.imagionDetectionEndpoint,\r\n        imagionBadgeEnabled: items.imagionBadgeEnabled !== false,\r\n        imagionDisabledHosts: Array.isArray(items.imagionDisabledHosts)\r\n          ? items.imagionDisabledHosts.filter((host) => typeof host === \"string\")\r\n          : [],\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nfunction setStorage(data: ExtensionSettings): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    chrome.storage.local.set(data, () => resolve());\r\n  });\r\n}\r\n\r\nfunction showStatus(message: string, success = true) {\r\n  statusNode.textContent = message;\r\n  statusNode.style.color = success ? \"#22c55e\" : \"#f87171\";\r\n}\r\n\r\nfunction clearStatus(delay = 3000) {\r\n  setTimeout(() => {\r\n    statusNode.textContent = \"\";\r\n  }, delay);\r\n}\r\n\r\nfunction normalizeHost(input: string): string | null {\r\n  const trimmed = input.trim();\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n  try {\r\n    const parsed = trimmed.includes(\"://\") ? new URL(trimmed) : new URL(`https://${trimmed}`);\r\n    return parsed.hostname.toLowerCase();\r\n  } catch {\r\n    return trimmed.toLowerCase();\r\n  }\r\n}\r\n\r\nfunction renderDomainList() {\r\n  domainList.innerHTML = \"\";\r\n  blockedHosts.forEach((host) => {\r\n    const li = document.createElement(\"li\");\r\n    li.textContent = host;\r\n    const removeButton = document.createElement(\"button\");\r\n    removeButton.type = \"button\";\r\n    removeButton.className = \"remove-domain\";\r\n    removeButton.textContent = strings.removeButtonLabel;\r\n    removeButton.addEventListener(\"click\", () => {\r\n      blockedHosts = blockedHosts.filter((entry) => entry !== host);\r\n      renderDomainList();\r\n      persistSettings(false);\r\n      showStatus(strings.domainRemovedMessage);\r\n      clearStatus();\r\n    });\r\n    li.appendChild(removeButton);\r\n    domainList.appendChild(li);\r\n  });\r\n}\r\n\r\nasync function persistSettings(showFeedback = true) {\r\n  const payload: ExtensionSettings = {\r\n    imagionApiKey: apiKeyInput.value.trim(),\r\n    imagionDetectionEndpoint: endpointInput.value.trim() || DEFAULTS.imagionDetectionEndpoint,\r\n    imagionBadgeEnabled: badgeToggle.checked,\r\n    imagionDisabledHosts: blockedHosts,\r\n  };\r\n  try {\r\n    await setStorage(payload);\r\n    if (showFeedback) {\r\n      showStatus(strings.savedMessage);\r\n      clearStatus();\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    showStatus(strings.saveErrorMessage, false);\r\n    clearStatus();\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function populateForm() {\r\n  const stored = await getStorage();\r\n  apiKeyInput.value = stored.imagionApiKey;\r\n  endpointInput.value = stored.imagionDetectionEndpoint;\r\n  badgeToggle.checked = stored.imagionBadgeEnabled;\r\n  blockedHosts = stored.imagionDisabledHosts;\r\n  renderDomainList();\r\n  domainInput.placeholder = strings.domainPlaceholder;\r\n  const domainLabel = document.querySelector(\".domain-blocker label\");\r\n  if (domainLabel) {\r\n    domainLabel.textContent = strings.addDomainLabel;\r\n  }\r\n  addDomainButton.textContent = strings.addButtonLabel;\r\n}\r\n\r\nform.addEventListener(\"submit\", async (event) => {\r\n  event.preventDefault();\r\n  saveButton.disabled = true;\r\n  showStatus(strings.savingMessage, true);\r\n  await persistSettings();\r\n  saveButton.disabled = false;\r\n  clearStatus();\r\n});\r\n\r\naddDomainButton.addEventListener(\"click\", async () => {\r\n  const normalized = normalizeHost(domainInput.value);\r\n  if (!normalized) {\r\n    return;\r\n  }\r\n  if (blockedHosts.includes(normalized)) {\r\n    showStatus(strings.domainExistsMessage, false);\r\n    clearStatus();\r\n    return;\r\n  }\r\n  blockedHosts = [...blockedHosts, normalized];\r\n  renderDomainList();\r\n  await persistSettings(false);\r\n  showStatus(strings.domainAddedMessage);\r\n  clearStatus();\r\n  domainInput.value = \"\";\r\n});\r\n\r\nstatusNode.setAttribute(\"aria-live\", \"polite\");\r\ndomainList.setAttribute(\"aria-live\", \"polite\");\r\n\r\npopulateForm();\r\n\r\nexport {};\r\n"],"names":["LOCALE_MAP","DEFAULTS","form","apiKeyInput","endpointInput","badgeToggle","statusNode","saveButton","domainInput","addDomainButton","domainList","localeCode","strings","blockedHosts","getStorage","resolve","items","host","setStorage","data","showStatus","message","success","clearStatus","delay","normalizeHost","input","trimmed","renderDomainList","li","removeButton","entry","persistSettings","showFeedback","payload","populateForm","stored","domainLabel","event","normalized"],"mappings":"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"}