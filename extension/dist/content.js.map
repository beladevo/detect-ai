{"version":3,"file":"content.js","sources":["../src/content.ts"],"sourcesContent":["const LOG_PREFIX = \"[Imagion Content]\";\r\nconst STYLE_ID = \"imagion-badge-style\";\r\nconst MAX_TRACKED_IMAGES = 200;\r\nconst MIN_IMAGE_SIZE = 50; // Minimum width/height to track\r\n\r\n// Skip extension on our own domains to prevent React hydration errors\r\nconst EXCLUDED_DOMAINS = [\r\n  \"localhost\",\r\n  \"127.0.0.1\",\r\n  \"imagion.ai\",\r\n  \"www.imagion.ai\",\r\n];\r\nconst trackedImages = new Map<HTMLImageElement, { badge: HTMLDivElement; wrapper: HTMLSpanElement }>();\r\nlet badgeCounter = 0;\r\nlet positionScheduled = false;\r\nlet scanScheduled = false;\r\nconst state = {\r\n  enabled: true,\r\n};\r\n\r\ntype BadgeResponse = {\r\n  status?: \"success\" | \"missing-key\" | \"error\" | \"rate-limit\";\r\n  verdict?: string;\r\n  score?: number;\r\n  confidence?: number;\r\n  presentation?: string;\r\n  message?: string;\r\n  badgeId: string;\r\n  imageUrl?: string;\r\n  retryAfterSeconds?: number;\r\n  badgeLabel?: string;\r\n};\r\n\r\ntype ContentLocaleStrings = {\r\n  aiLabel: string;\r\n  realLabel: string;\r\n  errorLabel: string;\r\n  loginLabel: string;\r\n  badgePrefix: string;\r\n  tooltipFallback: string;\r\n  rateLimitLabel: string;\r\n  disabledHostMessage: string;\r\n};\r\n\r\nconst TRANSLATIONS: Record<string, ContentLocaleStrings> = {\r\n  en: {\r\n    aiLabel: \"AI\",\r\n    realLabel: \"Real\",\r\n    errorLabel: \"Error\",\r\n    loginLabel: \"Log in\",\r\n    badgePrefix: \"Imagion badge\",\r\n    tooltipFallback: \"Imagion verdict\",\r\n    rateLimitLabel: \"Rate limited\",\r\n    disabledHostMessage: \"Badges paused on this host.\",\r\n  },\r\n  es: {\r\n    aiLabel: \"IA\",\r\n    realLabel: \"Real\",\r\n    errorLabel: \"Error\",\r\n    loginLabel: \"Iniciar sesión\",\r\n    badgePrefix: \"Insignia Imagion\",\r\n    tooltipFallback: \"Veredicto de Imagion\",\r\n    rateLimitLabel: \"Límite de velocidad\",\r\n    disabledHostMessage: \"Insignias pausadas en este host.\",\r\n  },\r\n};\r\n\r\nconst localeCode = navigator.language.split(\"-\")[0];\r\nconst localized = TRANSLATIONS[localeCode] ?? TRANSLATIONS.en;\r\n\r\nconst badgeStyle = `\r\n.imagion-wrapper {\r\n  position: relative !important;\r\n  display: inline-block !important;\r\n}\r\n.imagion-badge {\r\n  position: absolute !important;\r\n  top: 6px !important;\r\n  right: 6px !important;\r\n  pointer-events: auto !important;\r\n  cursor: default !important;\r\n  display: inline-flex !important;\r\n  align-items: center !important;\r\n  gap: 4px !important;\r\n  padding: 3px 8px !important;\r\n  font-size: 11px !important;\r\n  font-weight: 600 !important;\r\n  border-radius: 4px !important;\r\n  background: rgba(100, 100, 100, 0.9) !important;\r\n  color: #fff !important;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4) !important;\r\n  letter-spacing: 0.02em !important;\r\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif !important;\r\n  text-transform: uppercase !important;\r\n  white-space: nowrap !important;\r\n  margin: 0 !important;\r\n  border: none !important;\r\n  text-decoration: none !important;\r\n  line-height: 1.2 !important;\r\n}\r\n.imagion-badge__logo {\r\n  width: 14px !important;\r\n  height: 14px !important;\r\n  display: inline-flex !important;\r\n  align-items: center !important;\r\n  justify-content: center !important;\r\n  border-radius: 3px !important;\r\n  background: #fff !important;\r\n  color: #1a1a2e !important;\r\n  font-size: 9px !important;\r\n  font-weight: 700 !important;\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n}\r\n.imagion-badge__label {\r\n  line-height: 1 !important;\r\n}\r\n.imagion-badge--pending {\r\n  background: rgba(100, 100, 100, 0.9) !important;\r\n}\r\n.imagion-badge--ai {\r\n  background: rgba(220, 53, 69, 0.95) !important;\r\n}\r\n.imagion-badge--real {\r\n  background: rgba(40, 167, 69, 0.95) !important;\r\n}\r\n.imagion-badge--error {\r\n  background: rgba(255, 69, 96, 0.9) !important;\r\n}\r\n.imagion-badge--missing-key {\r\n  background: rgba(255, 193, 7, 0.95) !important;\r\n  color: #1a1a1a !important;\r\n}\r\n`;\r\n\r\nfunction insertBadgeStyles() {\r\n  if (document.getElementById(STYLE_ID)) {\r\n    return;\r\n  }\r\n  const style = document.createElement(\"style\");\r\n  style.id = STYLE_ID;\r\n  style.textContent = badgeStyle;\r\n  (document.head || document.documentElement).appendChild(style);\r\n  console.log(LOG_PREFIX, \"Badge styles injected\");\r\n}\r\n\r\nfunction schedulePositionUpdate() {\r\n  if (positionScheduled) {\r\n    return;\r\n  }\r\n  positionScheduled = true;\r\n  requestAnimationFrame(() => {\r\n    positionScheduled = false;\r\n    updateAllBadgePositions();\r\n  });\r\n}\r\n\r\nfunction scheduleScan() {\r\n  if (scanScheduled) {\r\n    return;\r\n  }\r\n  scanScheduled = true;\r\n  requestAnimationFrame(() => {\r\n    scanScheduled = false;\r\n    scanForImages();\r\n  });\r\n}\r\n\r\nfunction updateAllBadgePositions() {\r\n  for (const [img, meta] of trackedImages) {\r\n    if (!img.isConnected) {\r\n      removeBadgeAndWrapper(img, meta);\r\n      trackedImages.delete(img);\r\n    }\r\n  }\r\n}\r\n\r\nfunction removeBadgeAndWrapper(img: HTMLImageElement, meta: { badge: HTMLDivElement; wrapper: HTMLSpanElement }) {\r\n  const { badge, wrapper } = meta;\r\n  badge.remove();\r\n  // Restore image to its original position\r\n  if (wrapper.parentNode) {\r\n    wrapper.parentNode.insertBefore(img, wrapper);\r\n    wrapper.remove();\r\n  }\r\n}\r\n\r\nfunction isExcludedDomain(hostname: string) {\r\n  const normalized = hostname.toLowerCase();\r\n  return EXCLUDED_DOMAINS.some((domain) => normalized === domain || normalized.endsWith(`.${domain}`));\r\n}\r\n\r\nfunction shouldSkipScanning() {\r\n  return !state.enabled || isHostBlocked(window.location.hostname) || isExcludedDomain(window.location.hostname);\r\n}\r\n\r\nfunction scanForImages() {\r\n  if (shouldSkipScanning()) {\r\n    console.log(LOG_PREFIX, \"Scanning skipped (disabled or host blocked)\");\r\n    removeAllBadges();\r\n    return;\r\n  }\r\n  const images = Array.from(document.images) as HTMLImageElement[];\r\n  const newImages = images.filter((img) => shouldTrackImage(img));\r\n  if (newImages.length > 0) {\r\n    console.log(LOG_PREFIX, `Found ${newImages.length} new images to track (total on page: ${images.length})`);\r\n  }\r\n  for (const img of newImages) {\r\n    attachBadge(img);\r\n  }\r\n}\r\n\r\nfunction shouldTrackImage(img: HTMLImageElement) {\r\n  if (trackedImages.has(img)) {\r\n    return false;\r\n  }\r\n  if (trackedImages.size >= MAX_TRACKED_IMAGES) {\r\n    return false;\r\n  }\r\n  if (!img.src) {\r\n    return false;\r\n  }\r\n  // Skip data URIs\r\n  if (img.src.startsWith(\"data:\")) {\r\n    return false;\r\n  }\r\n  // Skip tiny images (icons, avatars, etc.)\r\n  const rect = img.getBoundingClientRect();\r\n  if (rect.width < MIN_IMAGE_SIZE || rect.height < MIN_IMAGE_SIZE) {\r\n    return false;\r\n  }\r\n  // Skip images that are not visible\r\n  if (rect.width === 0 || rect.height === 0) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction attachBadge(img: HTMLImageElement) {\r\n  const badge = document.createElement(\"div\");\r\n  badge.className = \"imagion-badge imagion-badge--pending\";\r\n  badge.setAttribute(\"role\", \"status\");\r\n  badge.setAttribute(\"lang\", localeCode);\r\n  badge.innerHTML = `<span class=\"imagion-badge__logo\">I</span><span class=\"imagion-badge__label\">...</span>`;\r\n  updateBadgeAria(badge, \"Analyzing\");\r\n  badge.dataset.requestState = \"pending\";\r\n  const badgeId = `imagion-${++badgeCounter}`;\r\n  badge.dataset.requestId = badgeId;\r\n\r\n  // Wrap image in a container and insert badge as sibling\r\n  const wrapper = document.createElement(\"span\");\r\n  wrapper.className = \"imagion-wrapper\";\r\n\r\n  // Match the image's z-index\r\n  const computedStyle = window.getComputedStyle(img);\r\n  const imgZIndex = computedStyle.zIndex;\r\n  if (imgZIndex && imgZIndex !== \"auto\") {\r\n    wrapper.style.zIndex = imgZIndex;\r\n  }\r\n\r\n  const parent = img.parentNode;\r\n  if (parent) {\r\n    parent.insertBefore(wrapper, img);\r\n    wrapper.appendChild(img);\r\n    wrapper.appendChild(badge);\r\n  }\r\n\r\n  trackedImages.set(img, { badge, wrapper });\r\n\r\n  requestDetection(img, badge, badgeId);\r\n}\r\n\r\nfunction requestDetection(img: HTMLImageElement, badge: HTMLDivElement, badgeId: string) {\r\n  const imageUrl = img.currentSrc || img.src;\r\n  if (!imageUrl || imageUrl.startsWith(\"data:\")) {\r\n    console.log(LOG_PREFIX, `Skipping data URI for ${badgeId}`);\r\n    updateBadgeFromResponse(badge, {\r\n      status: \"error\",\r\n      message: \"Unable to analyze data URI.\",\r\n      badgeId,\r\n    });\r\n    return;\r\n  }\r\n\r\n  console.log(LOG_PREFIX, `Requesting detection for ${badgeId}:`, imageUrl.substring(0, 100));\r\n\r\n  const payload = {\r\n    type: \"REQUEST_DETECTION\" as const,\r\n    imageUrl,\r\n    badgeId,\r\n    pageUrl: window.location.href,\r\n  };\r\n\r\n  sendDetectionRequest(payload)\r\n    .then((response) => {\r\n      console.log(LOG_PREFIX, `Response for ${badgeId}:`, response.status, response.verdict || response.message);\r\n      updateBadgeFromResponse(badge, response);\r\n    })\r\n    .catch((error) => {\r\n      console.error(LOG_PREFIX, `Error for ${badgeId}:`, error);\r\n      updateBadgeFromResponse(badge, {\r\n        status: \"error\",\r\n        message: error?.message || \"Detection request failed.\",\r\n        badgeId,\r\n      });\r\n    });\r\n}\r\n\r\nfunction sendDetectionRequest(payload: {\r\n  type: \"REQUEST_DETECTION\";\r\n  imageUrl: string;\r\n  badgeId: string;\r\n  pageUrl: string;\r\n}): Promise<BadgeResponse> {\r\n  return new Promise((resolve) => {\r\n    chrome.runtime.sendMessage(payload, (response) => {\r\n      if (chrome.runtime.lastError) {\r\n        console.error(LOG_PREFIX, \"Runtime error:\", chrome.runtime.lastError.message);\r\n        resolve({\r\n          status: \"error\",\r\n          message: chrome.runtime.lastError.message,\r\n          badgeId: payload.badgeId,\r\n        });\r\n        return;\r\n      }\r\n      resolve(response as BadgeResponse);\r\n    });\r\n  });\r\n}\r\n\r\nfunction updateBadgeFromResponse(badge: HTMLDivElement, response: BadgeResponse) {\r\n  if (!badge || !response) {\r\n    return;\r\n  }\r\n\r\n  if (badge.dataset.requestId !== response.badgeId) {\r\n    return;\r\n  }\r\n\r\n  const label = badge.querySelector(\".imagion-badge__label\");\r\n  if (!label) {\r\n    return;\r\n  }\r\n\r\n  badge.classList.remove(\r\n    \"imagion-badge--pending\",\r\n    \"imagion-badge--ai\",\r\n    \"imagion-badge--real\",\r\n    \"imagion-badge--error\",\r\n    \"imagion-badge--missing-key\"\r\n  );\r\n\r\n  if (response.status === \"success\" && response.verdict) {\r\n    const verdict = response.verdict.toLowerCase();\r\n    if (verdict === \"ai\" || verdict === \"fake\" || verdict === \"ai_generated\" || verdict === \"likely_ai\") {\r\n      badge.classList.add(\"imagion-badge--ai\");\r\n      label.textContent = localized.aiLabel;\r\n      updateBadgeAria(badge, localized.aiLabel);\r\n    } else {\r\n      badge.classList.add(\"imagion-badge--real\");\r\n      label.textContent = localized.realLabel;\r\n      updateBadgeAria(badge, localized.realLabel);\r\n    }\r\n    badge.title = createTooltip(response);\r\n    badge.dataset.requestState = \"success\";\r\n  } else if (response.status === \"missing-key\") {\r\n    badge.classList.add(\"imagion-badge--missing-key\");\r\n    label.textContent = localized.loginLabel;\r\n    updateBadgeAria(badge, localized.loginLabel);\r\n    badge.title = response.message || \"Click the Imagion icon to sign in.\";\r\n    badge.dataset.requestState = \"key-required\";\r\n  } else if (response.status === \"rate-limit\") {\r\n    const rateLimitLabel = response.badgeLabel ?? localized.rateLimitLabel;\r\n    badge.classList.add(\"imagion-badge--error\");\r\n    label.textContent = rateLimitLabel;\r\n    updateBadgeAria(badge, rateLimitLabel);\r\n    badge.title = response.message || localized.disabledHostMessage;\r\n    badge.dataset.requestState = \"rate-limit\";\r\n  } else {\r\n    badge.classList.add(\"imagion-badge--error\");\r\n    label.textContent = localized.errorLabel;\r\n    updateBadgeAria(badge, localized.errorLabel);\r\n    badge.title = response.message || \"Detection failed.\";\r\n    badge.dataset.requestState = \"error\";\r\n  }\r\n}\r\n\r\nfunction updateBadgeAria(badge: HTMLDivElement, text: string) {\r\n  badge.setAttribute(\"aria-label\", `${localized.badgePrefix}: ${text}`);\r\n}\r\n\r\nfunction createTooltip(response: BadgeResponse) {\r\n  const parts: string[] = [];\r\n  if (response.verdict) {\r\n    parts.push(`Verdict: ${response.verdict}`);\r\n  }\r\n  if (response.score != null) {\r\n    parts.push(`Score: ${(Number(response.score) * 100).toFixed(0)}%`);\r\n  }\r\n  if (response.confidence != null) {\r\n    parts.push(`Confidence: ${(Number(response.confidence) * 100).toFixed(0)}%`);\r\n  }\r\n  if (response.presentation) {\r\n    parts.push(response.presentation);\r\n  }\r\n  return parts.length ? parts.join(\"\\n\") : localized.tooltipFallback;\r\n}\r\n\r\nfunction removeAllBadges() {\r\n  const count = trackedImages.size;\r\n  for (const [img, meta] of trackedImages) {\r\n    removeBadgeAndWrapper(img, meta);\r\n  }\r\n  trackedImages.clear();\r\n  if (count > 0) {\r\n    console.log(LOG_PREFIX, `Removed ${count} badges`);\r\n  }\r\n}\r\n\r\nfunction updateDisabledHosts(items: Record<string, unknown>) {\r\n  const storedHosts = Array.isArray(items.imagionDisabledHosts) ? items.imagionDisabledHosts : [];\r\n  const normalized = storedHosts\r\n    .map((host) => normalizeHostname(host))\r\n    .filter((value): value is string => Boolean(value));\r\n  disabledHostsSet = new Set(normalized);\r\n  if (normalized.length > 0) {\r\n    console.log(LOG_PREFIX, \"Disabled hosts:\", normalized);\r\n  }\r\n}\r\n\r\nfunction normalizeHostname(value: string): string | null {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n  try {\r\n    const parsed = trimmed.includes(\"://\") ? new URL(trimmed) : new URL(`https://${trimmed}`);\r\n    return parsed.hostname.toLowerCase();\r\n  } catch {\r\n    return trimmed.toLowerCase();\r\n  }\r\n}\r\n\r\nfunction isHostBlocked(host: string) {\r\n  const normalized = normalizeHostname(host);\r\n  if (!normalized) {\r\n    return false;\r\n  }\r\n  const candidate = normalized.startsWith(\"www.\") ? normalized.slice(4) : normalized;\r\n  return disabledHostsSet.has(normalized) || disabledHostsSet.has(candidate);\r\n}\r\n\r\nlet disabledHostsSet = new Set<string>();\r\n\r\nfunction syncSettings() {\r\n  chrome.storage.local.get(\r\n    { imagionBadgeEnabled: true, imagionDisabledHosts: [] },\r\n    (items) => {\r\n      const enabled = items.imagionBadgeEnabled !== false;\r\n      state.enabled = enabled;\r\n      updateDisabledHosts(items);\r\n\r\n      console.log(LOG_PREFIX, \"Settings synced:\", { enabled, hostBlocked: isHostBlocked(window.location.hostname) });\r\n\r\n      if (shouldSkipScanning()) {\r\n        removeAllBadges();\r\n        return;\r\n      }\r\n      if (state.enabled) {\r\n        scheduleScan();\r\n      } else {\r\n        removeAllBadges();\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nfunction init() {\r\n  console.log(LOG_PREFIX, \"Initializing on\", window.location.hostname);\r\n\r\n  // Skip entirely on our own domains to prevent React hydration issues\r\n  if (isExcludedDomain(window.location.hostname)) {\r\n    console.log(LOG_PREFIX, \"Skipping on excluded domain:\", window.location.hostname);\r\n    return;\r\n  }\r\n\r\n  insertBadgeStyles();\r\n  syncSettings();\r\n\r\n  // Initial scan after a short delay to let images load\r\n  setTimeout(() => {\r\n    scanForImages();\r\n    schedulePositionUpdate();\r\n  }, 500);\r\n\r\n  const observerTarget = document.documentElement || document.body;\r\n  if (observerTarget) {\r\n    const mutationObserver = new MutationObserver(() => scheduleScan());\r\n    mutationObserver.observe(observerTarget, { childList: true, subtree: true });\r\n    console.log(LOG_PREFIX, \"MutationObserver attached\");\r\n  }\r\n\r\n  window.addEventListener(\"scroll\", schedulePositionUpdate, { passive: true });\r\n  window.addEventListener(\"resize\", schedulePositionUpdate);\r\n  chrome.storage.onChanged.addListener(syncSettings);\r\n\r\n  console.log(LOG_PREFIX, \"Initialization complete\");\r\n}\r\n\r\nif (document.readyState === \"loading\") {\r\n  document.addEventListener(\"DOMContentLoaded\", init);\r\n} else {\r\n  init();\r\n}\r\n\r\nexport {};\r\n"],"names":["LOG_PREFIX","STYLE_ID","EXCLUDED_DOMAINS","trackedImages","badgeCounter","positionScheduled","scanScheduled","state","TRANSLATIONS","localeCode","localized","badgeStyle","insertBadgeStyles","style","schedulePositionUpdate","updateAllBadgePositions","scheduleScan","scanForImages","img","meta","removeBadgeAndWrapper","badge","wrapper","isExcludedDomain","hostname","normalized","domain","shouldSkipScanning","isHostBlocked","removeAllBadges","images","newImages","shouldTrackImage","attachBadge","rect","updateBadgeAria","badgeId","imgZIndex","parent","requestDetection","imageUrl","updateBadgeFromResponse","payload","sendDetectionRequest","response","error","resolve","label","verdict","createTooltip","rateLimitLabel","text","parts","count","updateDisabledHosts","items","host","normalizeHostname","value","disabledHostsSet","trimmed","candidate","syncSettings","enabled","init","observerTarget"],"mappings":"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"}