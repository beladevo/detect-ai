(function(){"use strict";const o="[Imagion Popup]",g="http://localhost:3000",K="/api/auth/extension",h=document.getElementById("view-loading"),E=document.getElementById("view-login"),f=document.getElementById("view-authenticated"),x=document.getElementById("login-form"),v=document.getElementById("email"),w=document.getElementById("password"),L=document.getElementById("login-btn"),u=document.getElementById("login-status"),I=document.getElementById("advanced-toggle"),B=document.getElementById("advanced-section"),k=document.getElementById("endpoint-input"),P=document.getElementById("user-email"),S=document.getElementById("user-tier"),N=document.getElementById("monthly-detections"),F=document.getElementById("total-detections"),O=document.getElementById("api-key-display"),r=document.getElementById("copy-api-key"),m=document.getElementById("badge-toggle"),R=document.getElementById("logout-btn"),D=document.getElementById("register-link"),b=document.getElementById("forgot-link"),T=document.getElementById("dashboard-link"),M=document.getElementById("options-link");let s="",n=g;function l(e){switch(h.classList.remove("active"),E.classList.remove("active"),f.classList.remove("active"),e){case"loading":h.classList.add("active");break;case"login":E.classList.add("active");break;case"authenticated":f.classList.add("active");break}}function c(e,t){u.textContent=e,u.className=`status show ${t}`}function H(){u.className="status"}function d(e){L.disabled=e,L.innerHTML=e?'<span class="spinner"></span> Signing in...':"Sign In"}function _(e){return!e||e.length<20?e:`${e.substring(0,12)}...${e.substring(e.length-4)}`}async function A(){return new Promise(e=>{chrome.storage.local.get({imagionApiKey:"",imagionDetectionEndpoint:`${g}/api/detect`,imagionBadgeEnabled:!0,imagionUserEmail:"",imagionUserTier:"",imagionMonthlyDetections:0,imagionTotalDetections:0},t=>e(t))})}async function p(e){return new Promise(t=>{chrome.storage.local.set(e,()=>t())})}async function j(){console.log(o,"Checking auth status...");const e=await A();if(e.imagionDetectionEndpoint)try{const t=new URL(e.imagionDetectionEndpoint);n=`${t.protocol}//${t.host}`}catch{n=g}k.value=n,e.imagionApiKey?(console.log(o,"User is authenticated"),s=e.imagionApiKey,U(e),l("authenticated")):(console.log(o,"User is not authenticated"),l("login"))}function U(e){P.textContent=e.imagionUserEmail||"Unknown",S.textContent=e.imagionUserTier||"FREE",N.textContent=String(e.imagionMonthlyDetections||0),F.textContent=String(e.imagionTotalDetections||0),O.textContent=_(e.imagionApiKey||""),m.checked=e.imagionBadgeEnabled!==!1,D.href=`${n}/register`,b.href=`${n}/forgot-password`,T.href=`${n}/dashboard`}async function V(e){e.preventDefault(),H();const t=v.value.trim(),$=w.value,C=k.value.trim();if(!t||!$){c("Please enter email and password","error");return}if(C)try{const i=new URL(C);n=`${i.protocol}//${i.host}`}catch{c("Invalid endpoint URL","error");return}d(!0),console.log(o,"Attempting login for:",t);try{const i=await fetch(`${n}${K}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:$})}),a=await i.json();if(console.log(o,"Auth response:",i.status,a.success),!i.ok||!a.success){c(a.error||"Authentication failed","error"),d(!1);return}if(!a.apiKey){c("No API key received","error"),d(!1);return}await p({imagionApiKey:a.apiKey,imagionDetectionEndpoint:`${n}/api/detect`,imagionUserEmail:a.user?.email||t,imagionUserTier:a.user?.tier||"FREE",imagionMonthlyDetections:a.user?.monthlyDetections||0,imagionTotalDetections:a.user?.totalDetections||0,imagionBadgeEnabled:!0}),s=a.apiKey,console.log(o,"Login successful, API key saved"),v.value="",w.value="";const q=await A();U(q),l("authenticated")}catch(i){console.error(o,"Login error:",i),c(i instanceof Error?i.message:"Network error. Check your connection.","error")}finally{d(!1)}}async function z(){console.log(o,"Logging out..."),await p({imagionApiKey:"",imagionUserEmail:"",imagionUserTier:"",imagionMonthlyDetections:0,imagionTotalDetections:0}),s="",l("login")}async function G(){if(s)try{await navigator.clipboard.writeText(s);const e=r.textContent;r.textContent="Copied!",setTimeout(()=>{r.textContent=e},2e3)}catch(e){console.error(o,"Failed to copy:",e)}}async function J(){const e=m.checked;console.log(o,"Badge toggle:",e),await p({imagionBadgeEnabled:e})}function X(){B.classList.toggle("show"),I.textContent=B.classList.contains("show")?"Hide advanced settings":"Advanced settings"}function y(e){chrome.tabs.create({url:e})}x.addEventListener("submit",V),R.addEventListener("click",z),r.addEventListener("click",G),m.addEventListener("change",J),I.addEventListener("click",X),D.addEventListener("click",e=>{e.preventDefault(),y(`${n}/register`)}),b.addEventListener("click",e=>{e.preventDefault(),y(`${n}/forgot-password`)}),T.addEventListener("click",e=>{e.preventDefault(),y(`${n}/dashboard`)}),M.addEventListener("click",e=>{e.preventDefault(),chrome.runtime.openOptionsPage()}),console.log(o,"Popup initialized"),j()})();
//# sourceMappingURL=popup.js.map
